(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();const H={titles:["@onlyv1be","@onlyv1b","@onlyv1","@onlyv","@only","@onl","@on","@o","@","@o","@on","@onl","@only","@onlyv","@onlyv1","@onlyv1b","@onlyv1be"],titleChangeInterval:300,contentDelay:300,controlsDelay:250,tiltMaxRotate:11,tiltMaxDepth:30},Bt={isInitialized:!1,isCabinetOpen:!1,isAdmin:!1,activeTab:"anime",currentTitleIndex:0,dynamicTabs:[],dynamicTabCounter:0,currentSortMode:"desc",editingCardId:null,adminToken:null,titleInterval:null,infoPanelTimeout:null,infoPanelHideTimeout:null,viewsInterval:null,cursorEffect:null},Fn=["titleInterval","infoPanelTimeout","infoPanelHideTimeout","viewsInterval"];class Bn{#e={...Bt};#t=new Map;subscribe(e,t){return this.#t.has(e)||this.#t.set(e,new Set),this.#t.get(e).add(t),()=>this.#t.get(e)?.delete(t)}get(e){return this.#e[e]}getAll(){return{...this.#e}}set(e,t){const s=this.#e[e];if(s===t)return;this.#e[e]=t,this.#t.get(e)?.forEach(r=>{try{r(t,s)}catch(u){console.error(`State subscriber error for key "${e}":`,u)}})}setMultiple(e){Object.entries(e).forEach(([t,s])=>this.set(t,s))}clearTimers(){Fn.forEach(e=>{const t=this.#e[e];t&&(e.includes("Interval")?clearInterval:clearTimeout)(t)})}reset(){this.clearTimers(),this.setMultiple(Bt)}}const f=new Bn,Ke=new Map;function nn(i){if(!i)return null;const e=Ke.get(i);if(e){const s=e.deref();if(s&&document.contains(s))return s;Ke.delete(i)}const t=document.getElementById(i);return t&&Ke.set(i,new WeakRef(t)),t}function g(i,e={},t=[]){const s=document.createElement(i);return Object.entries(e).forEach(([o,r])=>{if(o==="class")s.className=r;else if(o==="style"&&typeof r=="object")Object.assign(s.style,r);else if(o.startsWith("on")&&typeof r=="function"){const u=o.slice(2).toLowerCase();s.addEventListener(u,r)}else s.setAttribute(o,r)}),t.forEach(o=>{typeof o=="string"?s.appendChild(document.createTextNode(o)):o instanceof Node&&s.appendChild(o)}),s}function p(i,e,t,s){return i?(i.addEventListener(e,t,s),()=>i.removeEventListener(e,t,s)):()=>{}}function Ut(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}const sn="https://onlyv1be.run.place:8443",X={TABS:"/api/tabs",ADD_TAB:"/api/add-tab",REMOVE_TAB:"/api/remove-tab",CLEAR:"/api/clear",CARDS:"/api/cards",ADD_CARD:"/api/add-card",UPDATE_CARD:"/api/update-card",REMOVE_CARD:"/api/remove-card",VIEWS:"/api/views"};class Je extends Error{constructor(e,t,s=null){super(e),this.name="ApiError",this.status=t,this.data=s}}const on=()=>f.get("adminToken")||"",Un=i=>{const e={"Content-Type":"application/json"};return i&&(e.Authorization=`Bearer ${i}`),e},Hn=async i=>{try{return await i.json()}catch{return null}};async function mt(i,e={}){const t=`${sn}${i}`,s=on(),o={...Un(s),...e.headers};try{const r=await fetch(t,{...e,headers:o,cache:"no-store"});if(!r.ok){const u=await Hn(r);throw new Je(u?.message||`Request failed: ${r.status}`,r.status,u)}return await r.json()}catch(r){throw r instanceof Je?r:new Je(r.message||"Network error",0,null)}}const Ee=(i,e)=>mt(i,{method:"POST",body:JSON.stringify({...e,admin:on()})}),an=async(i,e)=>{try{const t=await mt(i);return Array.isArray(t?.[e])?t[e]:[]}catch(t){return console.error(`Failed to fetch ${e}:`,t),[]}},$={tabs:null,cards:{}},zn=async()=>{if($.tabs)return $.tabs;const i=await an(X.TABS,"tabs");return $.tabs=i,i},rn=()=>{$.tabs=null},De=i=>{i?delete $.cards[i]:$.cards={}},Gn=i=>(rn(),Ee(X.ADD_TAB,{title:i})),Wn=i=>(rn(),De(),Ee(X.REMOVE_TAB,{id:i}));async function Vn(i){if($.cards[i])return $.cards[i];const e=`${X.CARDS}?tab_id=${encodeURIComponent(i)}`,t=await an(e,"cards");return $.cards[i]=t,t}const $n=i=>(De(i.tabId),Ee(X.ADD_CARD,{tab_id:i.tabId,title:i.title,rating:i.rating,image:i.image||""})),Yn=i=>(De(i.tabId),Ee(X.UPDATE_CARD,{id:i.id,tab_id:i.tabId,title:i.title,rating:i.rating,image:i.image||""})),Ht=i=>(De(),Ee(X.REMOVE_CARD,{id:i}));async function Xn(){try{const i=await mt(X.VIEWS);return typeof i=="number"?i:i?.views??i?.count??0}catch{return 0}}const ln="onlyv1be-admin-token",zt=(i,e)=>{f.set("adminToken",i),f.set("isAdmin",e)},Zn=i=>{try{sessionStorage.setItem(ln,i)}catch{}},jn=()=>{try{sessionStorage.removeItem(ln)}catch{}};async function qn(i){try{const e=new TextEncoder().encode(i||""),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(o=>o.toString(16).padStart(2,"0")).join("")}catch{return""}}async function Kn(i){if(!i||typeof i!="string")return{success:!1,error:"Пароль не указан"};try{const e=await qn(i);if(!e)return{success:!1,error:"Ошибка хеширования"};zt(e,!0),Zn(e);try{const t=`${sn}/api/tabs`;if((await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({admin:e})})).status===403)return zt(null,!1),jn(),{success:!1,error:"Неверный пароль"}}catch{}return{success:!0}}catch(e){return console.error("Login error:",e),{success:!1,error:"Ошибка авторизации"}}}const Re=()=>f.get("isAdmin")===!0&&f.get("adminToken")!==null,cn={activeTab:"onlyv1be-active-tab",volume:"onlyv1be-volume"},Jn=(i,e,t)=>Math.max(e,Math.min(t,i));function Qn(i,e=null){try{const t=localStorage.getItem(i);return t===null?e:JSON.parse(t)}catch{return e}}function ei(i,e){try{return localStorage.setItem(i,JSON.stringify(e)),!0}catch{return!1}}const un=(i,e,t=s=>s)=>({get:()=>t(Qn(i,e)),set:s=>ei(i,t(s))}),dn=un(cn.activeTab,"anime"),mn=un(cn.volume,.5,i=>Jn(i,0,1)),ti=()=>dn.get(),ni=i=>dn.set(i),ii=()=>mn.get(),si=i=>mn.set(i);const{entries:fn,setPrototypeOf:Gt,isFrozen:oi,getPrototypeOf:ai,getOwnPropertyDescriptor:ri}=Object;let{freeze:I,seal:N,create:rt}=Object,{apply:lt,construct:ct}=typeof Reflect<"u"&&Reflect;I||(I=function(e){return e});N||(N=function(e){return e});lt||(lt=function(e,t){for(var s=arguments.length,o=new Array(s>2?s-2:0),r=2;r<s;r++)o[r-2]=arguments[r];return e.apply(t,o)});ct||(ct=function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),o=1;o<t;o++)s[o-1]=arguments[o];return new e(...s)});const Ie=O(Array.prototype.forEach),li=O(Array.prototype.lastIndexOf),Wt=O(Array.prototype.pop),ce=O(Array.prototype.push),ci=O(Array.prototype.splice),Me=O(String.prototype.toLowerCase),Qe=O(String.prototype.toString),et=O(String.prototype.match),ue=O(String.prototype.replace),ui=O(String.prototype.indexOf),di=O(String.prototype.trim),k=O(Object.prototype.hasOwnProperty),R=O(RegExp.prototype.test),de=mi(TypeError);function O(i){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,s=new Array(t>1?t-1:0),o=1;o<t;o++)s[o-1]=arguments[o];return lt(i,e,s)}}function mi(i){return function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return ct(i,t)}}function m(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Me;Gt&&Gt(i,null);let s=e.length;for(;s--;){let o=e[s];if(typeof o=="string"){const r=t(o);r!==o&&(oi(e)||(e[s]=r),o=r)}i[o]=!0}return i}function fi(i){for(let e=0;e<i.length;e++)k(i,e)||(i[e]=null);return i}function U(i){const e=rt(null);for(const[t,s]of fn(i))k(i,t)&&(Array.isArray(s)?e[t]=fi(s):s&&typeof s=="object"&&s.constructor===Object?e[t]=U(s):e[t]=s);return e}function me(i,e){for(;i!==null;){const s=ri(i,e);if(s){if(s.get)return O(s.get);if(typeof s.value=="function")return O(s.value)}i=ai(i)}function t(){return null}return t}const Vt=I(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),tt=I(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),nt=I(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),pi=I(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),it=I(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),hi=I(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),$t=I(["#text"]),Yt=I(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),st=I(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Xt=I(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Oe=I(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),gi=N(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Ti=N(/<%[\w\W]*|[\w\W]*%>/gm),Ei=N(/\$\{[\w\W]*/gm),bi=N(/^data-[\-\w.\u00B7-\uFFFF]+$/),yi=N(/^aria-[\-\w]+$/),pn=N(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Ai=N(/^(?:\w+script|data):/i),vi=N(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),hn=N(/^html$/i),Si=N(/^[a-z][.\w]*(-[.\w]+)+$/i);var Zt=Object.freeze({__proto__:null,ARIA_ATTR:yi,ATTR_WHITESPACE:vi,CUSTOM_ELEMENT:Si,DATA_ATTR:bi,DOCTYPE_NAME:hn,ERB_EXPR:Ti,IS_ALLOWED_URI:pn,IS_SCRIPT_OR_DATA:Ai,MUSTACHE_EXPR:gi,TMPLIT_EXPR:Ei});const fe={element:1,text:3,progressingInstruction:7,comment:8,document:9},Ci=function(){return typeof window>"u"?null:window},_i=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let s=null;const o="data-tt-policy-suffix";t&&t.hasAttribute(o)&&(s=t.getAttribute(o));const r="dompurify"+(s?"#"+s:"");try{return e.createPolicy(r,{createHTML(u){return u},createScriptURL(u){return u}})}catch{return console.warn("TrustedTypes policy "+r+" could not be created."),null}},jt=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function gn(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ci();const e=d=>gn(d);if(e.version="3.3.1",e.removed=[],!i||!i.document||i.document.nodeType!==fe.document||!i.Element)return e.isSupported=!1,e;let{document:t}=i;const s=t,o=s.currentScript,{DocumentFragment:r,HTMLTemplateElement:u,Node:x,Element:C,NodeFilter:y,NamedNodeMap:D=i.NamedNodeMap||i.MozNamedAttrMap,HTMLFormElement:Y,DOMParser:be,trustedTypes:Z}=i,K=C.prototype,ft=me(K,"cloneNode"),En=me(K,"remove"),bn=me(K,"nextSibling"),yn=me(K,"childNodes"),ye=me(K,"parentNode");if(typeof u=="function"){const d=t.createElement("template");d.content&&d.content.ownerDocument&&(t=d.content.ownerDocument)}let w,oe="";const{implementation:ke,createNodeIterator:An,createDocumentFragment:vn,getElementsByTagName:Sn}=t,{importNode:Cn}=s;let L=jt();e.isSupported=typeof fn=="function"&&typeof ye=="function"&&ke&&ke.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Pe,ERB_EXPR:Fe,TMPLIT_EXPR:Be,DATA_ATTR:_n,ARIA_ATTR:wn,IS_SCRIPT_OR_DATA:Ln,ATTR_WHITESPACE:pt,CUSTOM_ELEMENT:Rn}=Zt;let{IS_ALLOWED_URI:ht}=Zt,A=null;const gt=m({},[...Vt,...tt,...nt,...it,...$t]);let v=null;const Tt=m({},[...Yt,...st,...Xt,...Oe]);let T=Object.seal(rt(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ae=null,Ue=null;const J=Object.seal(rt(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Et=!0,He=!0,bt=!1,yt=!0,Q=!1,Ae=!0,j=!1,ze=!1,Ge=!1,ee=!1,ve=!1,Se=!1,At=!0,vt=!1;const In="user-content-";let We=!0,re=!1,te={},P=null;const Ve=m({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let St=null;const Ct=m({},["audio","video","img","source","image","track"]);let $e=null;const _t=m({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ce="http://www.w3.org/1998/Math/MathML",_e="http://www.w3.org/2000/svg",z="http://www.w3.org/1999/xhtml";let ne=z,Ye=!1,Xe=null;const On=m({},[Ce,_e,z],Qe);let we=m({},["mi","mo","mn","ms","mtext"]),Le=m({},["annotation-xml"]);const xn=m({},["title","style","font","a","script"]);let le=null;const Mn=["application/xhtml+xml","text/html"],Dn="text/html";let b=null,ie=null;const Nn=t.createElement("form"),wt=function(n){return n instanceof RegExp||n instanceof Function},Ze=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(ie&&ie===n)){if((!n||typeof n!="object")&&(n={}),n=U(n),le=Mn.indexOf(n.PARSER_MEDIA_TYPE)===-1?Dn:n.PARSER_MEDIA_TYPE,b=le==="application/xhtml+xml"?Qe:Me,A=k(n,"ALLOWED_TAGS")?m({},n.ALLOWED_TAGS,b):gt,v=k(n,"ALLOWED_ATTR")?m({},n.ALLOWED_ATTR,b):Tt,Xe=k(n,"ALLOWED_NAMESPACES")?m({},n.ALLOWED_NAMESPACES,Qe):On,$e=k(n,"ADD_URI_SAFE_ATTR")?m(U(_t),n.ADD_URI_SAFE_ATTR,b):_t,St=k(n,"ADD_DATA_URI_TAGS")?m(U(Ct),n.ADD_DATA_URI_TAGS,b):Ct,P=k(n,"FORBID_CONTENTS")?m({},n.FORBID_CONTENTS,b):Ve,ae=k(n,"FORBID_TAGS")?m({},n.FORBID_TAGS,b):U({}),Ue=k(n,"FORBID_ATTR")?m({},n.FORBID_ATTR,b):U({}),te=k(n,"USE_PROFILES")?n.USE_PROFILES:!1,Et=n.ALLOW_ARIA_ATTR!==!1,He=n.ALLOW_DATA_ATTR!==!1,bt=n.ALLOW_UNKNOWN_PROTOCOLS||!1,yt=n.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Q=n.SAFE_FOR_TEMPLATES||!1,Ae=n.SAFE_FOR_XML!==!1,j=n.WHOLE_DOCUMENT||!1,ee=n.RETURN_DOM||!1,ve=n.RETURN_DOM_FRAGMENT||!1,Se=n.RETURN_TRUSTED_TYPE||!1,Ge=n.FORCE_BODY||!1,At=n.SANITIZE_DOM!==!1,vt=n.SANITIZE_NAMED_PROPS||!1,We=n.KEEP_CONTENT!==!1,re=n.IN_PLACE||!1,ht=n.ALLOWED_URI_REGEXP||pn,ne=n.NAMESPACE||z,we=n.MATHML_TEXT_INTEGRATION_POINTS||we,Le=n.HTML_INTEGRATION_POINTS||Le,T=n.CUSTOM_ELEMENT_HANDLING||{},n.CUSTOM_ELEMENT_HANDLING&&wt(n.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(T.tagNameCheck=n.CUSTOM_ELEMENT_HANDLING.tagNameCheck),n.CUSTOM_ELEMENT_HANDLING&&wt(n.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(T.attributeNameCheck=n.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),n.CUSTOM_ELEMENT_HANDLING&&typeof n.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(T.allowCustomizedBuiltInElements=n.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Q&&(He=!1),ve&&(ee=!0),te&&(A=m({},$t),v=[],te.html===!0&&(m(A,Vt),m(v,Yt)),te.svg===!0&&(m(A,tt),m(v,st),m(v,Oe)),te.svgFilters===!0&&(m(A,nt),m(v,st),m(v,Oe)),te.mathMl===!0&&(m(A,it),m(v,Xt),m(v,Oe))),n.ADD_TAGS&&(typeof n.ADD_TAGS=="function"?J.tagCheck=n.ADD_TAGS:(A===gt&&(A=U(A)),m(A,n.ADD_TAGS,b))),n.ADD_ATTR&&(typeof n.ADD_ATTR=="function"?J.attributeCheck=n.ADD_ATTR:(v===Tt&&(v=U(v)),m(v,n.ADD_ATTR,b))),n.ADD_URI_SAFE_ATTR&&m($e,n.ADD_URI_SAFE_ATTR,b),n.FORBID_CONTENTS&&(P===Ve&&(P=U(P)),m(P,n.FORBID_CONTENTS,b)),n.ADD_FORBID_CONTENTS&&(P===Ve&&(P=U(P)),m(P,n.ADD_FORBID_CONTENTS,b)),We&&(A["#text"]=!0),j&&m(A,["html","head","body"]),A.table&&(m(A,["tbody"]),delete ae.tbody),n.TRUSTED_TYPES_POLICY){if(typeof n.TRUSTED_TYPES_POLICY.createHTML!="function")throw de('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof n.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw de('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');w=n.TRUSTED_TYPES_POLICY,oe=w.createHTML("")}else w===void 0&&(w=_i(Z,o)),w!==null&&typeof oe=="string"&&(oe=w.createHTML(""));I&&I(n),ie=n}},Lt=m({},[...tt,...nt,...pi]),Rt=m({},[...it,...hi]),kn=function(n){let a=ye(n);(!a||!a.tagName)&&(a={namespaceURI:ne,tagName:"template"});const c=Me(n.tagName),h=Me(a.tagName);return Xe[n.namespaceURI]?n.namespaceURI===_e?a.namespaceURI===z?c==="svg":a.namespaceURI===Ce?c==="svg"&&(h==="annotation-xml"||we[h]):!!Lt[c]:n.namespaceURI===Ce?a.namespaceURI===z?c==="math":a.namespaceURI===_e?c==="math"&&Le[h]:!!Rt[c]:n.namespaceURI===z?a.namespaceURI===_e&&!Le[h]||a.namespaceURI===Ce&&!we[h]?!1:!Rt[c]&&(xn[c]||!Lt[c]):!!(le==="application/xhtml+xml"&&Xe[n.namespaceURI]):!1},F=function(n){ce(e.removed,{element:n});try{ye(n).removeChild(n)}catch{En(n)}},q=function(n,a){try{ce(e.removed,{attribute:a.getAttributeNode(n),from:a})}catch{ce(e.removed,{attribute:null,from:a})}if(a.removeAttribute(n),n==="is")if(ee||ve)try{F(a)}catch{}else try{a.setAttribute(n,"")}catch{}},It=function(n){let a=null,c=null;if(Ge)n="<remove></remove>"+n;else{const E=et(n,/^[\r\n\t ]+/);c=E&&E[0]}le==="application/xhtml+xml"&&ne===z&&(n='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+n+"</body></html>");const h=w?w.createHTML(n):n;if(ne===z)try{a=new be().parseFromString(h,le)}catch{}if(!a||!a.documentElement){a=ke.createDocument(ne,"template",null);try{a.documentElement.innerHTML=Ye?oe:h}catch{}}const _=a.body||a.documentElement;return n&&c&&_.insertBefore(t.createTextNode(c),_.childNodes[0]||null),ne===z?Sn.call(a,j?"html":"body")[0]:j?a.documentElement:_},Ot=function(n){return An.call(n.ownerDocument||n,n,y.SHOW_ELEMENT|y.SHOW_COMMENT|y.SHOW_TEXT|y.SHOW_PROCESSING_INSTRUCTION|y.SHOW_CDATA_SECTION,null)},je=function(n){return n instanceof Y&&(typeof n.nodeName!="string"||typeof n.textContent!="string"||typeof n.removeChild!="function"||!(n.attributes instanceof D)||typeof n.removeAttribute!="function"||typeof n.setAttribute!="function"||typeof n.namespaceURI!="string"||typeof n.insertBefore!="function"||typeof n.hasChildNodes!="function")},xt=function(n){return typeof x=="function"&&n instanceof x};function G(d,n,a){Ie(d,c=>{c.call(e,n,a,ie)})}const Mt=function(n){let a=null;if(G(L.beforeSanitizeElements,n,null),je(n))return F(n),!0;const c=b(n.nodeName);if(G(L.uponSanitizeElement,n,{tagName:c,allowedTags:A}),Ae&&n.hasChildNodes()&&!xt(n.firstElementChild)&&R(/<[/\w!]/g,n.innerHTML)&&R(/<[/\w!]/g,n.textContent)||n.nodeType===fe.progressingInstruction||Ae&&n.nodeType===fe.comment&&R(/<[/\w]/g,n.data))return F(n),!0;if(!(J.tagCheck instanceof Function&&J.tagCheck(c))&&(!A[c]||ae[c])){if(!ae[c]&&Nt(c)&&(T.tagNameCheck instanceof RegExp&&R(T.tagNameCheck,c)||T.tagNameCheck instanceof Function&&T.tagNameCheck(c)))return!1;if(We&&!P[c]){const h=ye(n)||n.parentNode,_=yn(n)||n.childNodes;if(_&&h){const E=_.length;for(let M=E-1;M>=0;--M){const W=ft(_[M],!0);W.__removalCount=(n.__removalCount||0)+1,h.insertBefore(W,bn(n))}}}return F(n),!0}return n instanceof C&&!kn(n)||(c==="noscript"||c==="noembed"||c==="noframes")&&R(/<\/no(script|embed|frames)/i,n.innerHTML)?(F(n),!0):(Q&&n.nodeType===fe.text&&(a=n.textContent,Ie([Pe,Fe,Be],h=>{a=ue(a,h," ")}),n.textContent!==a&&(ce(e.removed,{element:n.cloneNode()}),n.textContent=a)),G(L.afterSanitizeElements,n,null),!1)},Dt=function(n,a,c){if(At&&(a==="id"||a==="name")&&(c in t||c in Nn))return!1;if(!(He&&!Ue[a]&&R(_n,a))){if(!(Et&&R(wn,a))){if(!(J.attributeCheck instanceof Function&&J.attributeCheck(a,n))){if(!v[a]||Ue[a]){if(!(Nt(n)&&(T.tagNameCheck instanceof RegExp&&R(T.tagNameCheck,n)||T.tagNameCheck instanceof Function&&T.tagNameCheck(n))&&(T.attributeNameCheck instanceof RegExp&&R(T.attributeNameCheck,a)||T.attributeNameCheck instanceof Function&&T.attributeNameCheck(a,n))||a==="is"&&T.allowCustomizedBuiltInElements&&(T.tagNameCheck instanceof RegExp&&R(T.tagNameCheck,c)||T.tagNameCheck instanceof Function&&T.tagNameCheck(c))))return!1}else if(!$e[a]){if(!R(ht,ue(c,pt,""))){if(!((a==="src"||a==="xlink:href"||a==="href")&&n!=="script"&&ui(c,"data:")===0&&St[n])){if(!(bt&&!R(Ln,ue(c,pt,"")))){if(c)return!1}}}}}}}return!0},Nt=function(n){return n!=="annotation-xml"&&et(n,Rn)},kt=function(n){G(L.beforeSanitizeAttributes,n,null);const{attributes:a}=n;if(!a||je(n))return;const c={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:v,forceKeepAttr:void 0};let h=a.length;for(;h--;){const _=a[h],{name:E,namespaceURI:M,value:W}=_,se=b(E),qe=W;let S=E==="value"?qe:di(qe);if(c.attrName=se,c.attrValue=S,c.keepAttr=!0,c.forceKeepAttr=void 0,G(L.uponSanitizeAttribute,n,c),S=c.attrValue,vt&&(se==="id"||se==="name")&&(q(E,n),S=In+S),Ae&&R(/((--!?|])>)|<\/(style|title|textarea)/i,S)){q(E,n);continue}if(se==="attributename"&&et(S,"href")){q(E,n);continue}if(c.forceKeepAttr)continue;if(!c.keepAttr){q(E,n);continue}if(!yt&&R(/\/>/i,S)){q(E,n);continue}Q&&Ie([Pe,Fe,Be],Ft=>{S=ue(S,Ft," ")});const Pt=b(n.nodeName);if(!Dt(Pt,se,S)){q(E,n);continue}if(w&&typeof Z=="object"&&typeof Z.getAttributeType=="function"&&!M)switch(Z.getAttributeType(Pt,se)){case"TrustedHTML":{S=w.createHTML(S);break}case"TrustedScriptURL":{S=w.createScriptURL(S);break}}if(S!==qe)try{M?n.setAttributeNS(M,E,S):n.setAttribute(E,S),je(n)?F(n):Wt(e.removed)}catch{q(E,n)}}G(L.afterSanitizeAttributes,n,null)},Pn=function d(n){let a=null;const c=Ot(n);for(G(L.beforeSanitizeShadowDOM,n,null);a=c.nextNode();)G(L.uponSanitizeShadowNode,a,null),Mt(a),kt(a),a.content instanceof r&&d(a.content);G(L.afterSanitizeShadowDOM,n,null)};return e.sanitize=function(d){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=null,c=null,h=null,_=null;if(Ye=!d,Ye&&(d="<!-->"),typeof d!="string"&&!xt(d))if(typeof d.toString=="function"){if(d=d.toString(),typeof d!="string")throw de("dirty is not a string, aborting")}else throw de("toString is not a function");if(!e.isSupported)return d;if(ze||Ze(n),e.removed=[],typeof d=="string"&&(re=!1),re){if(d.nodeName){const W=b(d.nodeName);if(!A[W]||ae[W])throw de("root node is forbidden and cannot be sanitized in-place")}}else if(d instanceof x)a=It("<!---->"),c=a.ownerDocument.importNode(d,!0),c.nodeType===fe.element&&c.nodeName==="BODY"||c.nodeName==="HTML"?a=c:a.appendChild(c);else{if(!ee&&!Q&&!j&&d.indexOf("<")===-1)return w&&Se?w.createHTML(d):d;if(a=It(d),!a)return ee?null:Se?oe:""}a&&Ge&&F(a.firstChild);const E=Ot(re?d:a);for(;h=E.nextNode();)Mt(h),kt(h),h.content instanceof r&&Pn(h.content);if(re)return d;if(ee){if(ve)for(_=vn.call(a.ownerDocument);a.firstChild;)_.appendChild(a.firstChild);else _=a;return(v.shadowroot||v.shadowrootmode)&&(_=Cn.call(s,_,!0)),_}let M=j?a.outerHTML:a.innerHTML;return j&&A["!doctype"]&&a.ownerDocument&&a.ownerDocument.doctype&&a.ownerDocument.doctype.name&&R(hn,a.ownerDocument.doctype.name)&&(M="<!DOCTYPE "+a.ownerDocument.doctype.name+`>
`+M),Q&&Ie([Pe,Fe,Be],W=>{M=ue(M,W," ")}),w&&Se?w.createHTML(M):M},e.setConfig=function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ze(d),ze=!0},e.clearConfig=function(){ie=null,ze=!1},e.isValidAttribute=function(d,n,a){ie||Ze({});const c=b(d),h=b(n);return Dt(c,h,a)},e.addHook=function(d,n){typeof n=="function"&&ce(L[d],n)},e.removeHook=function(d,n){if(n!==void 0){const a=li(L[d],n);return a===-1?void 0:ci(L[d],a,1)[0]}return Wt(L[d])},e.removeHooks=function(d){L[d]=[]},e.removeAllHooks=function(){L=jt()},e}var wi=gn();const Li={ALLOWED_TAGS:["b","i","em","strong","span","br"],ALLOWED_ATTR:["class"],ALLOW_DATA_ATTR:!1},Ri={ALLOWED_TAGS:["b","i","em","strong","span","br","img","div","h4","button","article"],ALLOWED_ATTR:["class","src","alt","data-id","data-tabid","style"],ALLOW_DATA_ATTR:!0};function qt(i,e="strict"){if(typeof i!="string")return"";let t;switch(e){case"card":t=Ri;break;case"permissive":t={};break;default:t=Li}return wi.sanitize(i,t)}function ge(i){if(typeof i!="string")return"";const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return i.replace(/[&<>"'/]/g,t=>e[t])}class Ii{constructor(e,t={}){this.data=e,this.options=t,this.element=null,this.cleanupFns=[]}createRemoveButton(){const{id:e}=this.data,{onRemove:t}=this.options;if(!f.get("isAdmin")||!t)return null;const s=g("button",{class:"remove-tab-btn","data-id":e,"aria-label":"Remove tab"},["✖"]);return this.cleanupFns.push(p(s,"click",o=>{o.stopPropagation(),t(this.data)})),s}handleClick(e){const{onSelect:t,onEdit:s}=this.options;if(f.get("isAdmin")&&e.ctrlKey&&s){e.stopPropagation(),s(this.data);return}t?.(this.data)}setupEventListeners(){const{onSelect:e}=this.options;e&&this.cleanupFns.push(p(this.element,"click",t=>this.handleClick(t))),this.cleanupFns.push(p(this.element,"keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this.element.click())}))}render(){const{id:e,title:t}=this.data,{active:s}=this.options;this.element=g("button",{class:`cabinet-tab ${s?"active":""}`,type:"button","data-tab":e,role:"tab","aria-selected":s?"true":"false"}),this.element.appendChild(g("span",{},[ge(t)]));const o=this.createRemoveButton();return o&&this.element.appendChild(o),this.setupEventListeners(),this.element}setActive(e){this.options.active=e,this.element&&(this.element.classList.toggle("active",e),this.element.setAttribute("aria-selected",e?"true":"false"))}destroy(){this.cleanupFns.forEach(e=>e()),this.cleanupFns=[],this.element&&(this.element.remove(),this.element=null)}}class Oi{constructor(e,t={}){this.container=e,this.options=t,this.tabs=[],this.activeTabId=null,this.addButton=null}clearTabs(){this.tabs.forEach(e=>e.destroy()),this.tabs=[],Array.from(this.container.querySelectorAll(".cabinet-tab:not(.add-tab)")).forEach(e=>e.remove())}createTab(e,t){return new Ii(e,{active:e.id===t,onSelect:s=>{this.setActive(s.id),this.options.onTabSelect?.(s)},onRemove:this.options.onTabRemove,onEdit:this.options.onTabEdit})}insertTab(e){this.addButton?this.container.insertBefore(e,this.addButton):this.container.appendChild(e)}updateAddButton(){this.addButton&&(this.addButton.style.display=f.get("isAdmin")?"inline-flex":"none")}render(e,t=null){this.clearTabs(),e.forEach(s=>{const o=this.createTab(s,t);this.insertTab(o.render()),this.tabs.push(o)}),this.activeTabId=t,this.updateAddButton()}setActive(e){this.tabs.forEach(t=>t.setActive(t.data.id===e)),this.activeTabId=e}setAddButton(e){this.addButton=e,e&&this.options.onAddTab&&p(e,"click",()=>{f.get("isAdmin")&&this.options.onAddTab()})}destroy(){this.tabs.forEach(e=>e.destroy()),this.tabs=[]}}const Kt={HIGH:7,MEDIUM:5},ot={HIGH:"white",MEDIUM:"yellow",LOW:"red"},xi=i=>{const e=parseFloat(i)||0;return e>=Kt.HIGH?ot.HIGH:e>=Kt.MEDIUM?ot.MEDIUM:ot.LOW};class Mi{constructor(e,t={}){this.data=e,this.options=t,this.element=null,this.cleanupFns=[]}createImage(){const{image:e,title:t}=this.data,s=g("div",{class:"tab-card-img-wrapper"});if(e){const o=g("img",{src:`data:image/jpeg;base64,${e}`,alt:ge(t),loading:"lazy"});s.appendChild(o)}return s}createRating(){const e=parseFloat(this.data.rating)||0;return g("div",{class:`card-rating ${xi(e)}`},[`${e.toFixed(1)}/10`])}createActions(){const{onEdit:e,onRemove:t}=this.options;if(!f.get("isAdmin")||!e&&!t)return null;const s=g("div",{class:"card-actions",style:{position:"absolute",top:"8px",right:"8px",display:"flex",gap:"6px",zIndex:"10"}});if(e){const o=g("button",{class:"edit-card-btn","aria-label":"Edit card"},["✏️"]);this.cleanupFns.push(p(o,"click",r=>{r.stopPropagation(),e(this.data)})),s.appendChild(o)}if(t){const o=g("button",{class:"remove-card-btn","aria-label":"Remove card"},["✖"]);this.cleanupFns.push(p(o,"click",r=>{r.stopPropagation(),t(this.data)})),s.appendChild(o)}return s}render(){const{id:e,title:t}=this.data,s=this.createImage();s.appendChild(this.createRating());const o=g("h4",{},[ge(t)]);this.element=g("article",{class:"tab-card","data-id":e},[s,o]);const r=this.createActions();return r&&this.element.appendChild(r),this.element}update(e){if(this.data={...this.data,...e},this.element?.parentNode){const t=this.element.parentNode,s=this.element,o=this.render();t.replaceChild(o,s)}}destroy(){this.cleanupFns.forEach(e=>e()),this.cleanupFns=[],this.element&&(this.element.remove(),this.element=null)}}const Di=(i,e)=>{if(e==="none")return[...i];const t=[...i],s=(o,r)=>{const u=(parseFloat(r.rating)||0)-(parseFloat(o.rating)||0);return e==="asc"?-u:u};return t.sort(s)};function Jt(i,e,t={},s="desc"){if(i.innerHTML="",i.classList.add("tab-grid"),e.length===0)return i.appendChild(g("div",{class:"empty-state"},["Нет карточек"])),[];const o=Di(e,s),r=document.createDocumentFragment(),u=o.map((x,C)=>{const y=new Mi(x,t),D=y.render();return D.style.animationDelay=`${C*.05}s`,r.appendChild(D),y});return i.appendChild(r),u}let xe=null;const Qt='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',Ni=()=>document.body.style.overflow="hidden",ki=()=>document.body.style.overflow="";class Pi{constructor(e){this.options={closeOnOverlay:!0,closable:!0,...e},this.element=null,this.previousFocus=null,this.cleanupFns=[],this.resolvePromise=null}createButton(e){const t=g("button",{class:`confirm-btn ${e.class||""}`,type:"button"},[e.label]);return this.cleanupFns.push(p(t,"click",()=>{e.onClick?e.onClick()!==!1&&this.close(e.value):this.close(e.value)})),t}createContent(){const{title:e,content:t,buttons:s=[]}=this.options,o=typeof t=="string"?g("div",{class:"modal-body"},[t]):t,r=s.map(u=>this.createButton(u));return g("div",{class:"custom-confirm-box",role:"dialog","aria-modal":"true","aria-labelledby":"modal-title"},[g("div",{class:"custom-confirm-title",id:"modal-title"},[e]),o,r.length>0?g("div",{class:"custom-confirm-buttons"},r):null].filter(Boolean))}trapFocus(e){const t=this.element.querySelectorAll(Qt);if(t.length===0)return;const s=t[0],o=t[t.length-1];e.shiftKey&&document.activeElement===s?(e.preventDefault(),o.focus()):!e.shiftKey&&document.activeElement===o&&(e.preventDefault(),s.focus())}setupEventListeners(){this.options.closeOnOverlay&&this.cleanupFns.push(p(this.element,"click",e=>{e.target===this.element&&this.close(null)})),this.cleanupFns.push(p(this.element,"keydown",e=>{e.key==="Escape"&&this.options.closable?this.close(null):e.key==="Tab"&&this.trapFocus(e)}))}render(){return this.element=g("div",{class:"custom-confirm-overlay",tabindex:"-1"},[this.createContent()]),this.setupEventListeners(),this.element}focusFirstElement(){requestAnimationFrame(()=>{(this.element.querySelector(Qt)||this.element).focus()})}open(){return new Promise(e=>{this.resolvePromise=e,this.previousFocus=document.activeElement,xe&&xe.close(null),xe=this,this.render(),document.body.appendChild(this.element),Ni(),this.focusFirstElement()})}close(e){this.element&&(this.cleanupFns.forEach(t=>t()),this.cleanupFns=[],this.element.remove(),this.element=null,ki(),this.previousFocus&&this.previousFocus.focus(),xe=null,this.resolvePromise&&this.resolvePromise(e))}}async function at(i,e={}){return await new Pi({title:i,buttons:[{label:"OK",class:"confirm-ok",value:!0},{label:"Отмена",class:"confirm-cancel",value:!1}],...e}).open()===!0}const V={SUCCESS:"success",ERROR:"error",WARNING:"warning",INFO:"info"},Fi={[V.SUCCESS]:"✅",[V.ERROR]:"❌",[V.WARNING]:"⚠️",[V.INFO]:"ℹ️"},Bi=`
.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10001;
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-width: 400px;
}
.toast {
    padding: 16px 24px;
    border-radius: 12px;
    background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #fff;
    font-size: 14px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
    animation: toastSlideIn 0.3s ease forwards;
    display: flex;
    align-items: center;
    gap: 12px;
}
.toast.toast-exit {
    animation: toastSlideOut 0.3s ease forwards;
}
.toast.success {
    border-color: rgba(86, 255, 173, 0.4);
    box-shadow: 0 0 20px rgba(86, 255, 173, 0.2);
}
.toast.error {
    border-color: rgba(255, 58, 47, 0.4);
    box-shadow: 0 0 20px rgba(255, 58, 47, 0.2);
}
.toast.warning {
    border-color: rgba(251, 191, 36, 0.4);
    box-shadow: 0 0 20px rgba(251, 191, 36, 0.2);
}
.toast-icon {
    font-size: 18px;
}
@keyframes toastSlideIn {
    from { opacity: 0; transform: translateX(100%); }
    to { opacity: 1; transform: translateX(0); }
}
@keyframes toastSlideOut {
    from { opacity: 1; transform: translateX(0); }
    to { opacity: 0; transform: translateX(100%); }
}
`;let Te=null;const Ui=()=>{if(document.getElementById("toast-styles"))return;const i=document.createElement("style");i.id="toast-styles",i.textContent=Bi,document.head.appendChild(i)},Hi=()=>{Te=g("div",{class:"toast-container","aria-live":"polite","aria-atomic":"true"}),document.body.appendChild(Te)},zi=()=>{Te&&document.contains(Te)||(Ui(),Hi())},Gi=(i,e)=>g("div",{class:`toast ${e}`,role:"alert"},[g("span",{class:"toast-icon"},[Fi[e]||""]),g("span",{},[i])]);function Ne(i,e={}){const{type:t=V.INFO,duration:s=3e3}=e;zi();const o=Gi(i,t);return Te.appendChild(o),s>0&&setTimeout(()=>Tn(o),s),o}function Tn(i){i?.parentNode&&(i.classList.add("toast-exit"),setTimeout(()=>i.remove(),300))}const Wi=i=>Ne(i,{type:V.SUCCESS}),Vi=i=>Ne(i,{type:V.ERROR,duration:5e3}),$i=i=>Ne(i,{type:V.WARNING}),B={showToast:Ne,dismissToast:Tn,success:Wi,error:Vi,warning:$i,ToastType:V};class Yi{constructor(e){this.elements=e,this.tabList=null,this.editingTabId=null,this.editingCardId=null,this._cardsCache={},this.init()}init(){this.initTabs(),this.initListeners(),this.initSortButtons(),this.initAdminFeatures(),this.refreshEdgeZones();const e=ti();e&&f.set("activeTab",e)}initTabs(){!this.elements.cabinetTabs||!this.elements.cabinetContent||(this.tabList=new Oi(this.elements.cabinetTabs,{onTabSelect:e=>this.setActiveTab(e.id),onTabRemove:async e=>{await at("Удалить вкладку?")&&(await Wn(e.id),this.loadTabs())},onTabEdit:e=>this.openTabEditor(e.id),onAddTab:()=>this.openTabEditor(null)}),this.tabList.setAddButton(this.elements.addTabBtn),this.loadTabs())}async loadTabs(){try{const t=(await zn()).map(o=>({id:o.id,title:o.title})).filter(o=>o.title);f.set("dynamicTabs",t);let s=f.get("activeTab");this.tabList.render(t,s),t.length>0&&!t.find(o=>o.id===s)&&(s=t[0].id),s&&this.setActiveTab(s)}catch(e){console.error("Failed to load tabs:",e),B.error("Ошибка загрузки вкладок")}}setActiveTab(e){f.set("activeTab",e),ni(e),this.tabList?.setActive(e),this.elements.cabinetContent?.querySelectorAll(".tab-panel")?.forEach(s=>{s.classList.toggle("active",s.dataset.tab===String(e))}),this.loadCardsForTab(e)}async loadCardsForTab(e,t=!1){try{const s=nn(`cards-${e}`)||this.elements.cabinetContent;if(!t&&this._cardsCache[e]&&s){const r=f.get("currentSortMode");Jt(s,this._cardsCache[e].map(u=>({...u,tabId:e})),{onEdit:u=>this.openCardEditor(e,u),onRemove:async u=>{await at("Удалить карточку?")&&(await Ht(u.id),delete this._cardsCache[e],this.loadCardsForTab(e,!0))}},r),this.elements.cardsCount&&(this.elements.cardsCount.textContent=this._cardsCache[e].length)}const o=await Vn(e);if(this._cardsCache[e]=o,s){const r=f.get("currentSortMode");Jt(s,o.map(u=>({...u,tabId:e})),{onEdit:u=>this.openCardEditor(e,u),onRemove:async u=>{await at("Удалить карточку?")&&(await Ht(u.id),delete this._cardsCache[e],this.loadCardsForTab(e,!0))}},r)}this.elements.cardsCount&&(this.elements.cardsCount.textContent=o.length)}catch(s){console.error("Failed to load cards:",s)}}open(){if(f.get("isCabinetOpen"))return;const{mainPage:e,cabinetPage:t,slideBtn:s,cabinetBackBtn:o,edgeSwipeZone:r,edgeSwipeZoneLeft:u,music:x,video:C}=this.elements;e?.classList.add("slide-out"),t?.classList.add("slide-in"),t?.setAttribute("aria-hidden","false"),f.set("isCabinetOpen",!0),this.updateArrowState(!0),this.refreshEdgeZones(),this.loadTabs(),t?.scrollTo({top:0,behavior:"smooth"});try{x?.pause()}catch{}try{C?.pause()}catch{}if(s&&(s.style.display="none"),o&&(o.style.display="flex"),this.elements.volumeControl&&(this.elements.volumeControl.classList.remove("visible"),this.elements.volumeControl.style.pointerEvents="none"),this.elements.infoButton&&(this.elements.infoButton.classList.remove("visible"),this.elements.infoButton.style.pointerEvents="none"),this.elements.infoPanel){this.elements.infoPanel.classList.remove("visible");const y=f.get("infoPanelTimeout");y&&clearTimeout(y);const D=f.get("infoPanelHideTimeout");D&&clearTimeout(D)}}close(){if(!f.get("isCabinetOpen"))return;const{mainPage:e,cabinetPage:t,slideBtn:s,cabinetBackBtn:o,edgeSwipeZone:r,edgeSwipeZoneLeft:u,music:x,video:C}=this.elements;e?.classList.remove("slide-out"),t?.classList.remove("slide-in"),t?.setAttribute("aria-hidden","true"),f.set("isCabinetOpen",!1),this.updateArrowState(!1),this.refreshEdgeZones();try{x?.play()}catch{}try{C?.play()}catch{}s&&(s.style.display="flex"),o&&(o.style.display="none"),this.elements.volumeControl&&(this.elements.volumeControl.classList.add("visible"),this.elements.volumeControl.style.pointerEvents="auto"),this.elements.infoButton&&(this.elements.infoButton.classList.add("visible"),this.elements.infoButton.style.pointerEvents="auto")}toggle(e=null){(e===null?!f.get("isCabinetOpen"):e)?this.open():this.close()}updateArrowState(e){const t=this.elements.slideBtn;t&&(t.classList.toggle("open",!!e),t.setAttribute("aria-label",e?"Закрыть кабинет":"Открыть кабинет"))}refreshEdgeZones(){const e=f.get("isCabinetOpen");this.elements.edgeSwipeZone&&(this.elements.edgeSwipeZone.style.pointerEvents=e?"none":"auto",this.elements.edgeSwipeZone.style.opacity=e?"0":""),this.elements.edgeSwipeZoneLeft&&(this.elements.edgeSwipeZoneLeft.style.display=e?"block":"none")}openTabEditor(e){this.editingTabId=e;const t=this.elements.tabEditPanel;t&&(t.style.display="block",t.scrollIntoView({behavior:"smooth",block:"start"}),this.elements.tabTitleEdit&&(this.elements.tabTitleEdit.value=""))}closeTabEditor(){this.editingTabId=null,this.elements.tabEditPanel&&(this.elements.tabEditPanel.style.display="none")}async saveTab(){if(!Re())return;const e=this.elements.tabTitleEdit?.value?.trim();if(e)try{await Gn(e),this.closeTabEditor(),this.loadTabs(),B.success("Вкладка добавлена")}catch{B.error("Ошибка сохранения")}}openCardEditor(e,t=null){this.editingTabId=e,this.editingCardId=t?.id||null;const s=this.elements.cardEditPanel;s&&(s.style.display="block",s.scrollIntoView({behavior:"smooth",block:"start"}),this.elements.cardTitleEdit&&(this.elements.cardTitleEdit.value=t?.title||""),this.elements.cardRatingEdit&&(this.elements.cardRatingEdit.value=t?.rating||""),this.elements.saveCardBtnText&&(this.elements.saveCardBtnText.textContent=t?"Сохранить":"Добавить"),this.elements.cardImgEdit&&(this.elements.cardImgEdit.value=""))}closeCardEditor(){this.editingTabId=null,this.editingCardId=null,this.elements.cardEditPanel&&(this.elements.cardEditPanel.style.display="none")}async saveCard(){if(!Re()||!this.editingTabId)return;const e=this.elements.cardTitleEdit?.value?.trim();if(!e){B.warning("Введите название");return}let t=parseFloat(this.elements.cardRatingEdit?.value)||0;t=Math.max(0,Math.min(10,t));const s=this.elements.cardImgEdit?.files?.[0];let o="";s&&(o=await new Promise(r=>{const u=new FileReader;u.onload=()=>r(String(u.result).split(",")[1]),u.readAsDataURL(s)}));try{const r={tabId:this.editingTabId,title:e,rating:t.toString(),image:o};this.editingCardId?(await Yn({...r,id:this.editingCardId}),B.success("Обновлено")):(await $n(r),B.success("Создано"));const u=this.editingTabId;this.closeCardEditor(),this.loadCardsForTab(u)}catch{B.error("Ошибка сохранения карточки")}}initSortButtons(){const e=()=>{const s=f.get("currentSortMode");this.elements.sortDesc?.classList.toggle("active",s==="desc"),this.elements.sortAsc?.classList.toggle("active",s==="asc")},t=s=>{const r=f.get("currentSortMode")===s?"default":s;f.set("currentSortMode",r),e(),this.loadCardsForTab(f.get("activeTab"))};p(this.elements.sortDesc,"click",()=>t("desc")),p(this.elements.sortAsc,"click",()=>t("asc")),e()}toggleAdminUI(e){this.elements.addTabBtn&&(this.elements.addTabBtn.style.display=e?"inline-flex":"none");const t=document.querySelector(".cabinet-shell");e?t?.classList.add("editing-mode"):t?.classList.remove("editing-mode"),this.elements.adminLoginBlock&&(this.elements.adminLoginBlock.style.display="none"),e||(this.closeCardEditor(),this.closeTabEditor())}initAdminFeatures(){let e={e:!1,z:!1};p(document,"keydown",t=>{if(Re())return;const s=(t.key||"").toLowerCase();(s==="e"||t.key==="у")&&(e.e=!0),(s==="z"||t.key==="я")&&(e.z=!0),e.e&&e.z&&(this.elements.adminLoginBlock&&(this.elements.adminLoginBlock.style.display="flex",setTimeout(()=>this.elements.adminPasswordInput?.focus(),50)),e.e=e.z=!1)}),p(document,"keyup",t=>{const s=(t.key||"").toLowerCase();(s==="e"||t.key==="у")&&(e.e=!1),(s==="z"||t.key==="я")&&(e.z=!1)}),p(this.elements.adminGoBtn,"click",async()=>{const t=this.elements.adminPasswordInput?.value||"";(await Kn(t)).success?(B.success("Режим бога включен"),this.toggleAdminUI(!0),this.loadTabs()):B.error("Неверный пароль")})}initListeners(){p(this.elements.addTabBtn,"click",()=>{if(!Re())return B.warning("Нужен доступ (E+Z)");this.openTabEditor(null)}),p(this.elements.saveTabEditBtn,"click",()=>this.saveTab()),p(this.elements.closeTabEditBtn,"click",()=>this.closeTabEditor()),p(this.elements.saveCardEditBtn,"click",()=>this.saveCard()),p(this.elements.closeCardEditBtn,"click",()=>this.closeCardEditor()),p(document,"keydown",e=>{e.key==="Escape"&&(this.elements.cardEditPanel?.style.display==="block"?this.closeCardEditor():this.elements.tabEditPanel?.style.display==="block"?this.closeTabEditor():this.elements.adminLoginBlock?.style.display==="flex"?this.elements.adminLoginBlock.style.display="none":f.get("isCabinetOpen")&&this.close())})}}class Xi{constructor(e){this.elements=e}init(){if(!this.elements.volumeSlider||!this.elements.music)return;p(this.elements.volumeSlider,"input",t=>{this.handleVolumeInput(t.target.value)}),p(this.elements.volumeIcon,"click",t=>{t.stopPropagation(),this.toggleMute()});const e=ii();this.elements.music&&(this.elements.music.volume=e),this.elements.volumeSlider&&(this.elements.volumeSlider.value=e),this.updateVolumeIcon(e),this.updateSliderFill(e)}updateSliderFill(e){const t=this.elements.volumeSlider;if(!t)return;const s=Math.round(parseFloat(e)*100);t.style.background=`linear-gradient(to right, rgba(255,255,255,0.9) ${s}%, rgba(255,255,255,0.15) ${s}%)`}handleVolumeInput(e){if(this.elements.music){this.elements.music.muted=!1;const t=parseFloat(e);this.elements.music.volume=t,si(t),this.updateVolumeIcon(t),this.updateSliderFill(t)}}toggleMute(){if(this.elements.music){if(this.elements.music.muted){this.elements.music.muted=!1;const e=parseFloat(this.elements.volumeSlider.getAttribute("data-last-volume"))||.5;this.elements.music.volume=e,this.elements.volumeSlider.value=e}else this.elements.volumeSlider.setAttribute("data-last-volume",this.elements.volumeSlider.value),this.elements.music.muted=!0,this.elements.music.volume=0,this.elements.volumeSlider.value=0;this.updateVolumeIcon(this.elements.music.muted?0:this.elements.music.volume),this.updateSliderFill(this.elements.music.muted?0:this.elements.volumeSlider.value)}}updateVolumeIcon(e){const{highVolumeIcon:t,lowVolumeIcon:s,muteIcon:o,zeroVolumeIcon:r}=this.elements,u=Math.max(0,Number(e)),x=this.elements.music?.muted;[t,s,o,r].forEach(C=>{C&&(C.style.display="none")}),x||u<=.001?o&&(o.style.display="block"):u>.5?t&&(t.style.display="block"):s&&(s.style.display="block")}}function Zi(i,e=16){let t=0;return function(...o){const r=performance.now();r-t>=e&&(t=r,i.apply(this,o))}}class ji{constructor(e){this.elements=e}initTilt(){if(Ut()||!this.elements.mainContent)return;const e=Zi(t=>{const s=this.elements.mainContent;if(!s?.classList.contains("active"))return;if(t.target.closest(".controls-container")||t.target.closest(".volume-control")){this.resetTilt();return}const r=s.getBoundingClientRect(),u=(t.clientX-r.left)/r.width,x=(t.clientY-r.top)/r.height,C=(u-.5)*2,y=(x-.5)*2,D=-C*H.tiltMaxRotate,Y=y*H.tiltMaxRotate,Z=-Math.min(1,Math.hypot(C,y))*H.tiltMaxDepth;requestAnimationFrame(()=>{s.style.setProperty("--tilt-rotate-x",`${Y.toFixed(2)}deg`),s.style.setProperty("--tilt-rotate-y",`${D.toFixed(2)}deg`),s.style.setProperty("--tilt-depth",`${Z.toFixed(2)}px`),this.elements.viewersCounter&&(this.elements.viewersCounter.style.transform=`perspective(1100px) rotateX(${(Y*1.9).toFixed(2)}deg) rotateY(${(D*1.9).toFixed(2)}deg) translateZ(${(Z*1.7).toFixed(2)}px) scale(1.18)`)})},16);p(this.elements.mainContent,"mousemove",e),p(this.elements.mainContent,"mouseleave",()=>this.resetTilt())}resetTilt(){this.elements.mainContent&&(this.elements.mainContent.style.setProperty("--tilt-rotate-x","0deg"),this.elements.mainContent.style.setProperty("--tilt-rotate-y","0deg"),this.elements.mainContent.style.setProperty("--tilt-depth","0px"),this.elements.viewersCounter&&(this.elements.viewersCounter.style.transform=""))}initCursor(){if(Ut())return;const e=()=>{const t=window.cursoreffects||window.cursorEffects||window;if(t&&t.fairyDustCursor){try{new t.fairyDustCursor({colors:["#000000ff"]})}catch{}return}setTimeout(e,500)};window.requestIdleCallback?window.requestIdleCallback(e):setTimeout(e,1e3)}startTypewriter(){const e=this.elements.neonTypeEffect;if(!e)return;const t=e.closest(".main-desc"),s=(u,x,C)=>{let y=0;t?.classList.remove("error");const D=()=>{if(e.textContent=u.slice(0,y)+"_",y<u.length)y++,setTimeout(D,120);else{let Y=0;const be=setInterval(()=>{Y%2===0?e.innerHTML=qt(`<span class="shake-text">${ge(u)}</span><span class="shake-text blink-cursor">_</span>`,"permissive"):e.innerHTML=qt(`<span class="shake-text">${ge(u)}</span>`,"permissive"),Y++,Y>=4&&(clearInterval(be),C())},400)}};D()},o=u=>{t?.classList.add("error"),e.textContent="Error 404",setTimeout(u,2e3)},r=()=>{s('helloWorld("print")',!1,()=>{o(()=>{setTimeout(()=>{e.textContent="",t?.classList.remove("error"),r()},2e3)})})};r()}}console.log("🚀 System Booting...");const l={};function qi(){["welcomeScreen","loadingText","mainContent","mainPage","cabinetPage","background-video","backgroundMusic","volumeControl","volumeSlider","volumeIcon","highVolumeIcon","lowVolumeIcon","muteIcon","zeroVolumeIcon","infoButton","infoPanel","pageTitle","slideBtn","cabinetTabs","addTabBtn","cabinetContent","cabinetBackBtn","tabEditPanel","tabTitleEdit","saveTabEditBtn","closeTabEditBtn","cardEditPanel","cardTitleEdit","cardImgEdit","cardRatingEdit","saveCardBtnText","saveCardEditBtn","closeCardEditBtn","edgeSwipeZone","edgeSwipeZoneLeft","viewersCounter","viewsValue","neonTypeEffect","adminLoginBlock","adminPasswordInput","adminGoBtn","errorNotification","cardsCount","sortDesc","sortAsc"].forEach(e=>{const t=nn(e);t&&(l[e]=t)}),l.video=l["background-video"],l.music=l.backgroundMusic}let pe,ut,he;function dt(){l.infoPanel?.classList.remove("visible");const i=f.get("infoPanelTimeout");i&&clearTimeout(i)}function Ki(){if(!l.infoPanel)return;l.infoPanel.classList.add("visible");const i=setTimeout(dt,5e3);f.set("infoPanelTimeout",i)}function Ji(i,e){if(!f.get("isInitialized"))return;const t=document.createElement("div");t.className="click-effect",t.style.left=`${i}px`,t.style.top=`${e}px`,document.body.appendChild(t),setTimeout(()=>t.remove(),600)}function en(){f.get("isInitialized")||(f.set("isInitialized",!0),document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen().catch(i=>console.log("Fullscreen blocked:",i)),l.welcomeScreen&&l.welcomeScreen.classList.add("fade-out"),l.loadingText&&(l.loadingText.style.display="none"),ut&&ut.init(),l.music&&(l.music.volume=.5,l.music.play().catch(i=>console.log("Audio play failed:",i))),setTimeout(()=>{l.welcomeScreen&&(l.welcomeScreen.style.display="none"),l.mainContent&&(l.mainContent.style.display="block",l.video&&(l.video.style.display="block",l.video.muted=!0,l.video.play().catch(i=>console.log("Video play failed:",i)),requestAnimationFrame(()=>requestAnimationFrame(()=>l.video.classList.add("visible")))),setTimeout(()=>{l.mainContent.classList.add("active"),l.viewersCounter&&l.viewersCounter.classList.add("active"),setTimeout(()=>{he&&(he.initCursor(),he.initTilt(),he.startTypewriter())},800)},50)),l.cabinetPage&&(l.cabinetPage.style.display="flex"),setTimeout(()=>{l.volumeControl&&(l.volumeControl.classList.add("visible"),l.volumeControl.style.pointerEvents="auto"),l.infoButton&&l.infoButton.classList.add("visible"),l.slideBtn&&l.slideBtn.classList.add("visible")},H.controlsDelay)},H.contentDelay))}function Qi(){document.oncontextmenu=()=>!1,p(document,"click",s=>{Ji(s.clientX,s.clientY)}),p(document,"click",s=>{f.get("isInitialized")||l.infoPanel?.contains(s.target)||l.infoButton?.contains(s.target)||l.volumeControl?.contains(s.target)||en()}),p(document,"keydown",s=>{s.key==="Enter"&&en()}),l.infoButton&&p(l.infoButton,"click",s=>{s.stopPropagation(),l.infoPanel?.classList.contains("visible")?dt():Ki()}),l.infoPanel&&(p(l.infoPanel,"mouseleave",()=>{const s=setTimeout(dt,1e3);f.set("infoPanelHideTimeout",s)}),p(l.infoPanel,"mouseenter",()=>{clearTimeout(f.get("infoPanelHideTimeout")),clearTimeout(f.get("infoPanelTimeout"))})),l.slideBtn&&p(l.slideBtn,"click",s=>{s.stopPropagation(),pe.toggle()}),l.cabinetBackBtn&&p(l.cabinetBackBtn,"click",s=>{s.stopPropagation(),pe.close()});let e;l.edgeSwipeZone&&(p(l.edgeSwipeZone,"mouseenter",()=>{e=setTimeout(()=>pe.open(),200)}),p(l.edgeSwipeZone,"mouseleave",()=>clearTimeout(e)));let t;l.edgeSwipeZoneLeft&&(p(l.edgeSwipeZoneLeft,"mouseenter",()=>{t=setTimeout(()=>pe.close(),200)}),p(l.edgeSwipeZoneLeft,"mouseleave",()=>clearTimeout(t)))}async function es(){try{const i=await Xn();console.log("Views loaded:",i),l.viewsValue&&(l.viewsValue.innerText=i,l.viewsValue.textContent=i)}catch(i){console.error("Views error:",i)}}function tn(){qi(),es();try{pe=new Yi(l),ut=new Xi(l),he=new ji(l)}catch(e){console.error("Manager init error:",e)}Qi();let i=0;H.titles&&H.titles.length&&setInterval(()=>{l.pageTitle&&(l.pageTitle.textContent=H.titles[i],i=(i+1)%H.titles.length)},H.titleChangeInterval)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",tn):tn();
